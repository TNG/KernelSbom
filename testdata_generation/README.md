<!--
SPDX-License-Identifier: GPL-2.0-only OR MIT
Copyright (C) 2025 TNG Technology Consulting GmbH
-->

# Test Data Generation

This directory describes how the precompiled kernel builds in [KernelSbom-TestData](https://fileshare.tngtech.com/library/98e7e6f8-bffe-4a55-a8d2-817d4f3e51e8/KernelSbom-TestData/) were created.

Standard preconfigured kernel builds were obtained via:
- **linux.v6.17.tinyconfig.x86.tar.gz** `./extract_testdata.sh tinyconfig`
- **linux.v6.17.defconfig.x86.tar.gz** `./extract_testdata.sh defconfig`
- **linux.v6.17.allmodconfig.x86.tar.gz** `./extract_testdata.sh allmodconfig`

Additionally, distribution specific configs like **linux.v6.17.localmodconfig.Ubuntu24.04.x86.tar.gz** were created via: 
```bash
git clone --depth 1 --branch v6.17 https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
cd linux
make localmodconfig O=kernel_build
make -j$(nproc) O=kernel_build

# or alternatively
git clone https://github.com/gregkh/gregkh-linux.git
git clone --depth 1 --branch linux-6.17.y https://github.com/gregkh/linux.git
cd linux
mkdir kernel_build
cp ../gregkh-linux/stable/configs/6.17.y kernel_build/.config
make -j$(nproc) O=kernel_build

# Depending on the config, e.g., for localmodconfig some options might need to be disabled to make the build work.
scripts/config --file kernel_build/.config --undefine CONFIG_SYSTEM_REVOCATION_KEYS
scripts/config --file kernel_build/.config --undefine CONFIG_SYSTEM_REVOCATION_LIST
```

After building the kernel, the entire linux directory is archived and uploaded to the FileShare:
The following naming schema is used:
```bash
tar -czf linux.<version>.<config>.<arch>.<rust>.<in-tree>.tar.gz linux
```
where
- **version** The linux repo version, e.g., `v6.17`
- **config** The .config being used, either autogenerated ones like `defconfig`, or references to the origin repository like [gregkh-linux-stable](https://github.com/gregkh/gregkh-linux/tree/master/stable)
- **arch** The architecture for which the kernel was built. 
- **rust** Whether the build includes rust according to the setup in the [Dockerfile](./Dockerfile) (Defaults to no rust)
- **in-tree** Whether the build was in tree, i.e., obj_tree=src_tree. (Defaults to out of tree with `O=kernel_build`)
